<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking Management - RentMate Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0d9488',
                        secondary: '#0f766e',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Manrope', sans-serif; }
        
        .verification-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .verification-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .passport-preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .passport-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Admin Navigation Tabs */
        .admin-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .admin-tab {
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .admin-tab:hover {
            background-color: #f0fdfa;
        }

        .admin-tab.active {
            background-color: #0d9488;
            color: white;
        }

        /* Responsive Navigation */
        @media (max-width: 768px) {
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                width: 100%;
                justify-content: flex-start;
            }

            .top-nav-links {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <i data-lucide="shield" class="w-7 h-7 text-yellow-500"></i>
                    <span class="text-xl font-bold text-gray-800">RentMate Admin</span>
                </div>
                <div class="flex items-center space-x-6 top-nav-links">
                    <a href="/index.html" class="text-gray-700 hover:text-primary transition-colors">
                        <i data-lucide="home" class="w-4 h-4 inline mr-1"></i>
                        Home
                    </a>
                    <a href="/dashboard.html" class="text-gray-700 hover:text-primary transition-colors">
                        <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-1"></i>
                        Dashboard
                    </a>
                    <button onclick="logout()" class="text-gray-700 hover:text-primary transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4 inline mr-1"></i>
                        Logout
                    </button>
                </div>
                <button class="mobile-menu-btn text-gray-700" onclick="toggleMobileMenu()">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <!-- Admin Tabs -->
        <div class="bg-white rounded-lg shadow mb-8 p-4">
            <div class="admin-tabs">
                <button onclick="window.location.href='/admin.html'" class="admin-tab">
                    <i data-lucide="users" class="w-4 h-4"></i>
                    <span>Users</span>
                </button>
                <button onclick="window.location.href='/admin/items.html'" class="admin-tab">
                    <i data-lucide="package" class="w-4 h-4"></i>
                    <span>Items</span>
                </button>
                <button onclick="window.location.href='/admin/rentals.html'" class="admin-tab">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span>Rentals</span>
                </button>
                <button onclick="window.location.href='/admin/rental_management.html'" class="admin-tab">
                    <i data-lucide="workflow" class="w-4 h-4"></i>
                    <span>Rental Workflow</span>
                </button>
                <button onclick="window.location.href='/admin/verification.html'" class="admin-tab">
                    <i data-lucide="shield-check" class="w-4 h-4"></i>
                    <span>Verifications</span>
                </button>
                <button onclick="window.location.href='/admin/item_approval.html'" class="admin-tab">
                    <i data-lucide="package-check" class="w-4 h-4"></i>
                    <span>Item Approvals</span>
                </button>
                <button onclick="window.location.href='/admin/banking.html'" class="admin-tab active">
                    <i data-lucide="credit-card" class="w-4 h-4"></i>
                    <span>Banking</span>
                </button>
                <button onclick="window.location.href='/admin/statistics.html'" class="admin-tab">
                    <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
                    <span>Statistics</span>
                </button>
                <button onclick="window.location.href='/admin/support.html'" class="admin-tab">
                    <i data-lucide="life-buoy" class="w-4 h-4"></i>
                    <span>Customer Support</span>
                </button>
            </div>
        </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <i data-lucide="credit-card" class="w-8 h-8 text-primary"></i>
                        Payment Bank Accounts
                    </h1>
                    <p class="text-gray-600 mt-2">Manage bank accounts for receiving rental payments</p>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Total Accounts</p>
                        <p class="text-2xl font-bold text-gray-900 mt-1" id="totalBanks">0</p>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-lg">
                        <i data-lucide="credit-card" class="w-6 h-6 text-blue-600"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Active Accounts</p>
                        <p class="text-2xl font-bold text-green-600 mt-1" id="activeBanks">0</p>
                    </div>
                    <div class="bg-green-100 p-3 rounded-lg">
                        <i data-lucide="check-circle" class="w-6 h-6 text-green-600"></i>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">Inactive Accounts</p>
                        <p class="text-2xl font-bold text-gray-600 mt-1" id="inactiveBanks">0</p>
                    </div>
                    <div class="bg-gray-100 p-3 rounded-lg">
                        <i data-lucide="x-circle" class="w-6 h-6 text-gray-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Banking Grid -->
        <div id="bankingContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Bank cards will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-16">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mb-4">
                <i data-lucide="credit-card" class="w-10 h-10 text-gray-400"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No Bank Accounts</h3>
            <p class="text-gray-500">Add a bank account to start receiving payments.</p>
        </div>
    </div>

    <script src="../app.js"></script>
    <script>
        lucide.createIcons();

        // Check if admin is logged in (currentUser is already declared in app.js)
        if (!currentUser || currentUser.role !== 'admin') {
            window.location.href = '/admin.html';
        }

        let allBanking = [];

        // Load all banking accounts
        async function loadAllBanking() {
            try {
                const response = await api.getAllBanking();
                allBanking = response.data;
                displayBanking(allBanking);
                updateStats();
            } catch (error) {
                console.error('Error loading banking:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load banking accounts'
                });
            }
        }

        function updateStats() {
            const total = allBanking.length;
            const active = allBanking.filter(b => b.is_active).length;
            const inactive = total - active;
            
            document.getElementById('totalBanks').textContent = total;
            document.getElementById('activeBanks').textContent = active;
            document.getElementById('inactiveBanks').textContent = inactive;
        }

        function displayBanking(banking) {
            const container = document.getElementById('bankingContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (banking.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            container.innerHTML = banking.map(bank => `
                <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="bg-blue-100 p-2 rounded-lg">
                                <i data-lucide="building" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900">${bank.bank_name}</h3>
                                <p class="text-sm text-gray-500">${bank.account_type}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${bank.is_active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                            ${bank.is_active ? 'Active' : 'Inactive'}
                        </span>
                    </div>
                    
                    <div class="space-y-2 text-sm mb-4">
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="hash" class="w-4 h-4 mr-2"></i>
                            <span class="font-mono">${bank.bank_number}</span>
                        </div>
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                            <span>${bank.account_holder_name}</span>
                        </div>
                        ${bank.branch_name ? `
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                            <span>${bank.branch_name}</span>
                        </div>
                        ` : ''}
                        ${bank.swift_code ? `
                        <div class="flex items-center text-gray-600">
                            <i data-lucide="globe" class="w-4 h-4 mr-2"></i>
                            <span>${bank.swift_code}</span>
                        </div>
                        ` : ''}
                    </div>
                    
                    ${bank.purpose ? `
                    <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                        <p class="text-xs text-gray-500 mb-1">Purpose</p>
                        <p class="text-sm text-gray-700">${bank.purpose}</p>
                    </div>
                    ` : ''}
                    
                    <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                        <div class="flex items-center space-x-2">
                            <button onclick="viewBankDetails(${bank.id})" class="text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center">
                                <i data-lucide="eye" class="w-4 h-4 mr-1"></i>
                                View
                            </button>
                            <button onclick="editBank(${bank.id})" class="text-green-600 hover:text-green-700 text-sm font-medium flex items-center">
                                <i data-lucide="edit" class="w-4 h-4 mr-1"></i>
                                Edit
                            </button>
                            <button onclick="toggleBankStatus(${bank.id}, ${!bank.is_active})" class="text-orange-600 hover:text-orange-700 text-sm font-medium flex items-center">
                                <i data-lucide="${bank.is_active ? 'x-circle' : 'check-circle'}" class="w-4 h-4 mr-1"></i>
                                ${bank.is_active ? 'Deactivate' : 'Activate'}
                            </button>
                        </div>
                        <button onclick="deleteBank(${bank.id})" class="text-red-600 hover:text-red-700 text-sm font-medium flex items-center">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-1"></i>
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Re-initialize Lucide icons for the new content
            lucide.createIcons();
        }

        function viewBankDetails(id) {
            // Redirect to account detail page
            window.location.href = `/admin/account_detail.html?id=${id}`;
        }

        async function toggleBankStatus(id, newStatus) {
            try {
                const result = await Swal.fire({
                    title: `${newStatus ? 'Activate' : 'Deactivate'} Bank Account?`,
                    text: `Are you sure you want to ${newStatus ? 'activate' : 'deactivate'} this bank account?`,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: newStatus ? '#10b981' : '#ef4444',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: `Yes, ${newStatus ? 'Activate' : 'Deactivate'}`,
                    cancelButtonText: 'Cancel'
                });

                if (result.isConfirmed) {
                    await api.toggleBankingStatus(id);
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: `Bank account ${newStatus ? 'activated' : 'deactivated'} successfully!`,
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    await loadAllBanking();
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message || 'Failed to update bank status'
                });
            }
        }

        async function deleteBank(id) {
            try {
                const result = await Swal.fire({
                    title: 'Delete Bank Account?',
                    text: 'This action cannot be undone!',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'Yes, Delete',
                    cancelButtonText: 'Cancel'
                });

                if (result.isConfirmed) {
                    await api.deleteBanking(id);
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Deleted!',
                        text: 'Bank account deleted successfully!',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    await loadAllBanking();
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: error.message || 'Failed to delete bank account'
                });
            }
        }

        function editBank(id) {
            // Redirect to edit form with bank ID
            window.location.href = `/admin/edit_bank_account_form.html?id=${id}`;
        }

        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = '/admin.html';
        }

        function toggleMobileMenu() {
            const navLinks = document.querySelector('.top-nav-links');
            if (navLinks) {
                navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
                navLinks.style.flexDirection = 'column';
                navLinks.style.position = 'absolute';
                navLinks.style.top = '100%';
                navLinks.style.right = '0';
                navLinks.style.backgroundColor = 'white';
                navLinks.style.padding = '1rem';
                navLinks.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
                navLinks.style.borderRadius = '0.5rem';
                navLinks.style.marginTop = '0.5rem';
            }
        }

        // Initialize page
        window.addEventListener('DOMContentLoaded', async () => {
            lucide.createIcons();
            await loadAllBanking();
        });
    </script>
</body>
</html>
