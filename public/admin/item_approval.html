<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Approval - RentMate Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0d9488',
                        secondary: '#0f766e',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Manrope', sans-serif; }
        
        .item-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .item-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 0.5rem;
        }

        /* Admin Navigation Tabs */
        .admin-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .admin-tab {
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .admin-tab:hover {
            background-color: #f0fdfa;
        }

        .admin-tab.active {
            background-color: #0d9488;
            color: white;
        }

        /* Responsive Navigation */
        @media (max-width: 768px) {
            .admin-tabs {
                flex-direction: column;
            }
            
            .admin-tab {
                width: 100%;
                justify-content: flex-start;
            }

            .top-nav-links {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <i data-lucide="shield" class="w-7 h-7 text-yellow-500"></i>
                    <span class="text-xl font-bold text-gray-800">RentMate Admin</span>
                </div>
                <div class="flex items-center space-x-6 top-nav-links">
                    <a href="/index.html" class="text-gray-700 hover:text-primary transition-colors">
                        <i data-lucide="home" class="w-4 h-4 inline mr-1"></i>
                        Home
                    </a>
                    <a href="/dashboard.html" class="text-gray-700 hover:text-primary transition-colors">
                        <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-1"></i>
                        Dashboard
                    </a>
                    <button onclick="logout()" class="text-gray-700 hover:text-primary transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4 inline mr-1"></i>
                        Logout
                    </button>
                </div>
                <button class="mobile-menu-btn text-gray-700" onclick="toggleMobileMenu()">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-6 py-8">
        <!-- Admin Tabs -->
        <div class="bg-white rounded-lg shadow mb-8 p-4">
            <div class="admin-tabs">
                <button onclick="window.location.href='/admin.html'" class="admin-tab">
                    <i data-lucide="users" class="w-4 h-4"></i>
                    <span>Users</span>
                </button>
                <button onclick="window.location.href='/admin/items.html'" class="admin-tab">
                    <i data-lucide="package" class="w-4 h-4"></i>
                    <span>Items</span>
                </button>
                <button onclick="window.location.href='/admin/rentals.html'" class="admin-tab">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span>Rentals</span>
                </button>
                <button onclick="window.location.href='/admin/rental_management.html'" class="admin-tab">
                    <i data-lucide="workflow" class="w-4 h-4"></i>
                    <span>Rental Workflow</span>
                </button>
                <button onclick="window.location.href='/admin/verification.html'" class="admin-tab">
                    <i data-lucide="shield-check" class="w-4 h-4"></i>
                    <span>Verifications</span>
                </button>
                <button onclick="window.location.href='/admin/item_approval.html'" class="admin-tab active">
                    <i data-lucide="package-check" class="w-4 h-4"></i>
                    <span>Item Approvals</span>
                </button>
                <button onclick="window.location.href='/admin.html'" class="admin-tab">
                    <i data-lucide="bar-chart" class="w-4 h-4"></i>
                    <span>Statistics</span>
                </button>
            </div>
        </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Item Approval</h1>
            <p class="text-gray-600">Review and approve items submitted by verified lenders</p>
        </div>

        <!-- Pending Items Counter -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Pending Items</p>
                    <p id="pendingCount" class="text-3xl font-bold text-primary">0</p>
                </div>
                <div class="bg-primary/10 p-4 rounded-full">
                    <i data-lucide="package" class="w-8 h-8 text-primary"></i>
                </div>
            </div>
        </div>

        <!-- Pending Items Grid -->
        <div id="pendingItemsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Items will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="hidden text-center py-12">
            <i data-lucide="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">All Caught Up!</h3>
            <p class="text-gray-600">No pending items to review at the moment.</p>
        </div>
    </div>

    <script src="/app.js"></script>
    <script>
        // Check authentication and admin role
        if (!currentUser || currentUser.role !== 'admin') {
            window.location.href = '/login.html';
        }

        async function loadPendingItems() {
            try {
                const response = await api.request('/items/pending');
                
                if (response.success) {
                    const items = response.data;
                    const container = document.getElementById('pendingItemsContainer');
                    const emptyState = document.getElementById('emptyState');
                    const pendingCount = document.getElementById('pendingCount');
                    
                    pendingCount.textContent = items.length;

                    if (items.length === 0) {
                        container.classList.add('hidden');
                        emptyState.classList.remove('hidden');
                        return;
                    }

                    container.classList.remove('hidden');
                    emptyState.classList.add('hidden');

                    container.innerHTML = items.map(item => {
                        const images = item.images ? JSON.parse(item.images) : [];
                        const firstImage = images[0] || '/assets/images/placeholder.jpg';

                        return `
                            <div class="item-card p-4">
                                <img src="${firstImage}" alt="${item.name}" class="item-image mb-4" onerror="this.src='/assets/images/placeholder.jpg'">
                                
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">${item.name}</h3>
                                <p class="text-gray-600 text-sm mb-3 line-clamp-2">${item.description}</p>
                                
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center text-sm">
                                        <i data-lucide="user" class="w-4 h-4 text-gray-400 mr-2"></i>
                                        <span class="text-gray-700">${item.owner_name}</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i data-lucide="mail" class="w-4 h-4 text-gray-400 mr-2"></i>
                                        <span class="text-gray-600">${item.owner_email}</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i data-lucide="map-pin" class="w-4 h-4 text-gray-400 mr-2"></i>
                                        <span class="text-gray-600">${item.location}</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i data-lucide="tag" class="w-4 h-4 text-gray-400 mr-2"></i>
                                        <span class="text-gray-600">${item.category}</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i data-lucide="dollar-sign" class="w-4 h-4 text-gray-400 mr-2"></i>
                                        <span class="text-gray-900 font-semibold">$${item.price}/day</span>
                                        <span class="text-gray-500 ml-2">(Deposit: $${item.deposit})</span>
                                    </div>
                                </div>

                                <div class="flex gap-2">
                                    <button onclick="handleApproval(${item.id}, 'approved', '${item.name}', '${item.owner_name}')" 
                                            class="flex-1 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                                        <i data-lucide="check" class="w-4 h-4 inline mr-1"></i>
                                        Approve
                                    </button>
                                    <button onclick="handleApproval(${item.id}, 'rejected', '${item.name}', '${item.owner_name}')" 
                                            class="flex-1 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
                                        <i data-lucide="x" class="w-4 h-4 inline mr-1"></i>
                                        Reject
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');

                    lucide.createIcons();
                }
            } catch (error) {
                console.error('Error loading pending items:', error);
                ui.showNotification('Failed to load pending items', 'error');
            }
        }

        async function handleApproval(itemId, status, itemName, ownerName) {
            const action = status === 'approved' ? 'approve' : 'reject';
            
            const result = await Swal.fire({
                title: `${action.charAt(0).toUpperCase() + action.slice(1)} Item?`,
                html: `
                    <p class="mb-2">Are you sure you want to <strong>${action}</strong> this item?</p>
                    <div class="bg-gray-50 p-3 rounded-lg text-left mt-3">
                        <p class="text-sm"><strong>Item:</strong> ${itemName}</p>
                        <p class="text-sm"><strong>Owner:</strong> ${ownerName}</p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: status === 'approved' ? '#10b981' : '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: `Yes, ${action}`,
                cancelButtonText: 'Cancel'
            });

            if (result.isConfirmed) {
                try {
                    const response = await api.request(`/items/approve/${itemId}`, {
                        method: 'PUT',
                        body: JSON.stringify({ status })
                    });

                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: `Item ${status === 'approved' ? 'Approved' : 'Rejected'}!`,
                            text: `The item has been ${status === 'approved' ? 'approved and is now visible to users' : 'rejected'}.`,
                            timer: 2000,
                            showConfirmButton: false
                        });
                        
                        // Reload items
                        await loadPendingItems();
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: error.message
                    });
                }
            }
        }

        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = '/login.html';
        }

        function toggleMobileMenu() {
            const navLinks = document.querySelector('.top-nav-links');
            if (navLinks) {
                navLinks.style.display = navLinks.style.display === 'flex' ? 'none' : 'flex';
                navLinks.style.flexDirection = 'column';
                navLinks.style.position = 'absolute';
                navLinks.style.top = '100%';
                navLinks.style.right = '0';
                navLinks.style.backgroundColor = 'white';
                navLinks.style.padding = '1rem';
                navLinks.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
                navLinks.style.borderRadius = '0.5rem';
                navLinks.style.marginTop = '0.5rem';
            }
        }

        // Load items on page load
        window.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadPendingItems();
        });
    </script>
</body>
</html>
